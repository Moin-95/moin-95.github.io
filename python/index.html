<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Arthur Picerna" /><link rel="canonical" href="https://docs.ar2pi.net/python/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Python - ar2pi</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Python";
        var mkdocs_page_input_path = "python.md";
        var mkdocs_page_url = "/python/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> ar2pi
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="..">Arthur Picerna (ar2pi)</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Cheatsheets</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../go/">Go</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Python</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#local-setup">Local setup</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#on-mac">On Mac</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#on-linux-debian">On Linux (Debian)</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#configure-a-python-3-virtualenv">Configure a Python 3 virtualenv</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#generate-a-python-version-file">Generate a .python-version file</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#generate-a-requirementstxt-file">Generate a requirements.txt file</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#install-dependencies-from-a-requirementstxt-file">Install dependencies from a requirements.txt file</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#containerized-python-development">Containerized Python development</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#docs">Docs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#package-registry">Package registry</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#snippets">Snippets</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#consult-object-help">Consult object help</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#parse-arguments">Parse arguments</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#performance-counter">Performance counter</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#reference-count">Reference count</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#interning">Interning</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#peephole">Peephole</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#unpacking-zen">Unpacking zen</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#remove-list-duplicates">Remove list duplicates</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#overwrite-dictionary-values">Overwrite dictionary values</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#nested-unpacking">Nested unpacking</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../shell/">Shell</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../vim/">Vim</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../git/">Git</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../networking/">Networking</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../kubernetes/">Kubernetes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../linux-debian/">Linux (Debian)</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Lab</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../lab/prometheus-video-renderer/">Prometheus video renderer</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">ar2pi</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Cheatsheets</li>
      <li class="breadcrumb-item active">Python</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/ar2pi/ar2pi/edit/main/docs/python.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="python">Python</h1>
<h2 id="local-setup">Local setup</h2>
<p>Install <a href="https://github.com/pyenv/pyenv">pyenv</a> and <a href="https://github.com/pyenv/pyenv-virtualenv">pyenv-virtualenv</a>. Respectively for Python version management and virtualenvs management. </p>
<blockquote>
<p><code>pyenv-virtualenv</code> uses <code>python -m venv</code> (Python 3.3+) if it is available and the <code>virtualenv</code> command if not</p>
</blockquote>
<hr />
<h4 id="on-mac">On Mac</h4>
<pre><code class="language-sh">brew install pyenv-virtualenv
</code></pre>
<h4 id="on-linux-debian">On Linux (Debian)</h4>
<pre><code class="language-sh">sudo apt-get update; sudo apt-get install make build-essential libssl-dev zlib1g-dev \
  libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm \
  libncursesw5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev libffi-dev liblzma-dev

curl https://pyenv.run | bash
</code></pre>
<hr />
<pre><code class="language-sh">echo '''
# pyenv-virtualenv
# see https://github.com/pyenv/pyenv-virtualenv
export PYENV_ROOT=$HOME/.pyenv
export PATH=$PATH:$PYENV_ROOT/bin
eval &quot;$(pyenv init --path)&quot;
eval &quot;$(pyenv init -)&quot;
eval &quot;$(pyenv virtualenv-init -)&quot;
''' &gt;&gt; ~/.zshrc

source ~/.zshrc
</code></pre>
<h2 id="configure-a-python-3-virtualenv">Configure a <a href="https://www.python.org/downloads/">Python 3</a> virtualenv</h2>
<pre><code class="language-sh">pyenv install --list | grep 3.13 | less # list possible python versions

pyenv install 3.13              # install latest minor python version
pyenv virtualenv 3.13 python3   # create a new virtualenv
pyenv activate python3          # activate virtualenv
</code></pre>
<p>Other useful <code>pyenv</code> commands:</p>
<pre><code class="language-sh">pyenv deactivate    # deactivate current virtualenv

pyenv versions      # list installed python versions and available virtualenvs
pyenv which python  # see path to python executable
pyenv version-name  # see current virtualenv

pyenv uninstall python3 # remove virtualenv / python version
</code></pre>
<h2 id="generate-a-python-version-file">Generate a <code>.python-version</code> file</h2>
<pre><code class="language-sh">echo $(pyenv version-name) &gt; .python-version
</code></pre>
<p><code>.python-version</code> is then used by <code>pyenv-virtualenv</code> to automatically switch to correct virtualenv.</p>
<h2 id="generate-a-requirementstxt-file">Generate a <code>requirements.txt</code> file</h2>
<pre><code class="language-sh">pyenv virtualenv 3.9.6 [VENV_NAME] # create a new virtualenv
pip install [DEPENDENCY_1] [...] # install dependencies
pip freeze &gt; requirements.txt # freeze requirements
</code></pre>
<h2 id="install-dependencies-from-a-requirementstxt-file">Install dependencies from a requirements.txt file</h2>
<pre><code class="language-sh">pip install -r requirements.txt
</code></pre>
<h2 id="containerized-python-development">Containerized Python development</h2>
<ul>
<li><a href="https://github.com/ar2pi/run-python-script">run-python-script</a></li>
<li><a href="https://www.docker.com/blog/tag/python-env-series/">Read the Docker blog post series</a></li>
</ul>
<h2 id="docs">Docs</h2>
<ul>
<li><a href="https://docs.python.org/3/reference/index.html">The Python Language Reference</a></li>
<li><a href="https://docs.python.org/3/library/index.html">The Python Standard Library</a></li>
</ul>
<h2 id="package-registry">Package registry</h2>
<ul>
<li><a href="https://pypi.org/">PyPi</a></li>
</ul>
<h2 id="snippets">Snippets</h2>
<p><strong><code>#!/usr/bin/env python</code></strong></p>
<h3 id="consult-object-help">Consult object help</h3>
<pre><code class="language-python">help(set)
</code></pre>
<h3 id="parse-arguments">Parse arguments</h3>
<pre><code class="language-python">import argparse

parser = argparse.ArgumentParser()
parser.add_argument('-v', '--verbose', action='store_true')
parser.add_argument('-i', '--requests-interval', type=float, default=5)
args = parser.parse_args()

print(args.verbose, args.requests_interval)
</code></pre>
<p>Reference:
- <a href="https://docs.python.org/3/howto/argparse.html">https://docs.python.org/3/howto/argparse.html</a>
- <a href="https://docs.python.org/3/library/argparse.html">https://docs.python.org/3/library/argparse.html</a></p>
<h3 id="performance-counter">Performance counter</h3>
<p><a href="https://docs.python.org/3/library/time.html#time.perf_counter">time.perf_counter()</a></p>
<pre><code class="language-python">import time
start = time.perf_counter()
# ...
end = time.perf_counter()
print('timing: {time}'.format(time=(end - start)))
</code></pre>
<h3 id="reference-count">Reference count</h3>
<pre><code class="language-python">import ctypes
def ref_count(address):
    return ctypes.c_long.from_address(address).value
</code></pre>
<h3 id="interning">Interning</h3>
<pre><code class="language-python">a = 10
b = int('1010', 2)
print(hex(id(a)))
print(hex(id(b)))
a is b # True, in [-5, 256]

a = 500
b = 500
a is b # False
</code></pre>
<p>String interning: don't do this unless optimization is needed</p>
<pre><code class="language-python">import sys
a = 'foo'
b = 'foo'
a is b # True, looks like an identifier so gets interned... but don't count on it

a = 'foo bar'
b = 'foo bar'
a is b # False

a = sys.intern('foo bar')
b = sys.intern('foo bar')
a is b # True
</code></pre>
<h3 id="peephole">Peephole</h3>
<pre><code class="language-python">def my_func():
    a = 24 * 60
    b = 'foo'
    c = 'foo' * 2
    d = ['foo', 'bar']
    e = ('foo', 'bar')
    f = {'foo', 'bar'}

print(my_func.__code__.co_consts) 
# (None, 24, 60, 'foo', 2, 'bar', 1440, 'foofoo', ('foo', 'bar'))
</code></pre>
<h3 id="unpacking-zen">Unpacking zen</h3>
<h4 id="remove-list-duplicates">Remove list duplicates</h4>
<pre><code class="language-python">a = [1, 1, 2, 2, 3, 3]
*a, = {*a} # a = [1, 2, 3]
</code></pre>
<h4 id="overwrite-dictionary-values">Overwrite dictionary values</h4>
<pre><code class="language-python">a = {'foo': 'bar', 'baz': 'qux'}
b = {'foo': 'quux', 'quuz': 'courge'}
b = {**a, **b} # b = {'foo': 'quux', 'baz': 'qux', 'quuz': 'courge'}
</code></pre>
<h4 id="nested-unpacking">Nested unpacking</h4>
<pre><code class="language-python">a, *b, (c, d, e) = [1, 2, 3, 'XYZ']
# a = 1, b = [2, 3], c = 'X', d = 'Y', e = 'Z'
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../go/" class="btn btn-neutral float-left" title="Go"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../shell/" class="btn btn-neutral float-right" title="Shell">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/ar2pi/ar2pi/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../go/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../shell/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
